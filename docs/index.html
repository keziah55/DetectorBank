<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>A Hopf, Skip and a Jump: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">A Hopf, Skip and a Jump
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">A Hopf, Skip and a Jump Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Authors</dt><dd>(C) Nick Bailey &lt;nick at n-ism.org&gt; and Keziah Milligan </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>GPL v3. 18th February 2016. See <a href="http://www.gnu.org/licenses/gpl-3.0.en.html">http://www.gnu.org/licenses/gpl-3.0.en.html</a></dd></dl>
<h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>A Hopf, Skip and a Jump is a musicological tool which finds note onset times and frequencies in music.</p>
<p>This document covers the following components:</p>
<ul>
<li><a class="el" href="classDetectorBank.html" title="Use multiple detectors to find note onsets at given frequencies (with multithreading). ">DetectorBank</a>: a class for running many note-onset detectors in parallel;</li>
<li><a class="el" href="classslidingbuffer_1_1SlidingBuffer.html" title="SlidingBuffer is class template which can be used when reading a data stream to provide access to the...">slidingbuffer::SlidingBuffer</a>: a template class which can call upon a data producer to generate data on demand caching its recent history thus permitting backtracking; and</li>
<li><a class="el" href="classdetectorcache_1_1DetectorCache.html" title="Cache results from a detectorbank. ">detectorcache::DetectorCache</a>: a derived class of SlidingBuffer which is tailored to the detection of note-onsets by permitting pseudo-2D operation (channel number and sample number).</li>
</ul>
<h1><a class="anchor" id="DetectorBank"></a>
DetectorBank</h1>
<p>Suppose we have an 1d (numpy) array of input samples. Because the background of <a class="el" href="classDetectorBank.html" title="Use multiple detectors to find note onsets at given frequencies (with multithreading). ">DetectorBank</a> is audio analysis, the type of the input array is inputSample_t (as distributed: float). We want to run a plethora of similar tasks ("detectors") each with possibly different parameters on the input samples either in part or in their entirety. The output of each task is independent, and is written to a given 2d array of type <code>discriminator_t</code> (<code>complex&lt;double&gt;</code>) when it is supplied to the method <a class="el" href="classDetectorBank.html#a416bb9650c4fc16f7e1a451099526eaf"><code>getZ()</code></a>. The detector object responsible for applying the discriminator will maintain the discriminator's states between calls, permitting piece-wise or real-time usage.</p>
<p>The work is divided as equally as possible among a given number of threads. Repeated calls cause results to be generated from subsequent input values. So if there are 2 discriminators, and results are to be written on the first call into a 4 x 2 array the subsequently into a 3 x 2 array:</p>
<p><div class="dotgraph">
<img src="dot_two-calls.png" alt="dot_two-calls.png" border="0" usemap="#dot_two-calls.map"/>
<map name="dot_two-calls.map" id="dot_two-calls.map"></map>
<div class="caption">
Behaviour of a DetectorBank on successive calls</div>
</div>
 and the next call will start processing at the 7th sample.</p>
<p>As well as writing into the given output array, <code>getZ()</code> returns the number of input samples actually passed to the detectors. It will not attempt to read pass the end of the input array, so the number of samples converted may be less than the number implicitly requested by supplying an output array of given size, and will be 0 once all of the input samples have been processed.</p>
<p>A new input array may be supplied at any time using the <code>setInputBuffer</code> method. Doing so causes the next call to <code>getZ</code> to start from the beginning of the new input array.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classDetectorBank.html" title="Use multiple detectors to find note onsets at given frequencies (with multithreading). ">DetectorBank</a></dd></dl>
<h1><a class="anchor" id="SlidingBuffer"></a>
SlidingBuffer</h1>
<p>We provide a generic method of continually holding in memory the recent history of data read from a stream. For example, if a large number of pitches are being detected by a <a class="el" href="classDetectorBank.html" title="Use multiple detectors to find note onsets at given frequencies (with multithreading). ">DetectorBank</a> object in order to analyse note onsets in a recording lasting even a few minutes, the amount of system resource consumed to hold the (complex) output of each detector in addition to the audio input becomes infeasibly large for even modestly-sized input files.</p>
<p>In almost all cases, it is sufficient to cache only the recent samples emerging from the analysis, which reduced the total storage, including temporary storage required by the <a class="el" href="classDetectorBank.html" title="Use multiple detectors to find note onsets at given frequencies (with multithreading). ">DetectorBank</a> to produce the results, substantially. Using a SlidingBuffer, it becomes possible to read an entire audio sample file into memory, but retain only recenlty used analysis results. Hence one an onset is detected, it is possible to back-track for a time through recent output samples without the requirement to store the entire history of the detector output. As the samples in the sliding buffer exceed a specified age, they are silently discarded.</p>
<p>The SlidingBuffer class exposes an interface which accesses historical entities though the index operator <code>[]</code>.</p>
<p>Greater detail on the internal workings of the SlidingBuffer can be found <a class="el" href="SlidingBufferExample.html">here</a>.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classslidingbuffer_1_1SlidingBuffer.html" title="SlidingBuffer is class template which can be used when reading a data stream to provide access to the...">slidingbuffer::SlidingBuffer</a></dd></dl>
<h1><a class="anchor" id="DetectorCache"></a>
DetectorCache</h1>
<p><a class="el" href="classslidingbuffer_1_1SlidingBuffer.html" title="SlidingBuffer is class template which can be used when reading a data stream to provide access to the...">slidingbuffer::SlidingBuffer</a> generically caches the recent history of a (one-dimensional) stream, but <a class="el" href="classDetectorBank.html" title="Use multiple detectors to find note onsets at given frequencies (with multithreading). ">DetectorBank</a> objects produce several concurrent output streams from a single audio input. A DetectorCache is a specialisation of a SlidingBuffer which is accessed through both its channel number and sample number.</p>
<p>The result history of a single detector channel may be copied into a contiguous block of memory, regardless of the underlying implementation within SlidingBuffer, provided that sufficient history of the channel output is available.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classdetectorcache_1_1DetectorCache.html" title="Cache results from a detectorbank. ">detectorcache::DetectorCache</a></dd></dl>
<h1><a class="anchor" id="install"></a>
Installation</h1>
<p>On a Debian system, the following packages should be installed:</p>
<ul>
<li>python3-dev</li>
<li>swig (to build python3 bindings)</li>
<li>build-essential</li>
<li>autoconf-archive</li>
<li>libcereal-dev</li>
<li>librapidxml-dev</li>
<li>libfftw3-dev</li>
<li>doxygen (for the documentation)</li>
<li>python (for the documentation)</li>
<li>graphviz (for enhanced documentation)</li>
</ul>
<p>Invoke setup.py as follows:</p>
<div class="fragment"><div class="line">mkdir -p build</div><div class="line">cd build</div><div class="line">../configure</div><div class="line">make</div><div class="line"></div><div class="line"><span class="preprocessor"># Optionally build and run the unit tests</span></div><div class="line">make check</div><div class="line"><span class="preprocessor"># The results of the checks are written in test/test-suite.log</span></div><div class="line"></div><div class="line">sudo make install</div></div><!-- fragment --><p>Full documentation in LaTeX and HTML are generated at build time. PDF format can by obtained by running</p>
<div class="fragment"><div class="line">make doxygen-docs</div></div><!-- fragment --><h1><a class="anchor" id="python_usage"></a>
Python Usage</h1>
<p>Please see <a class="el" href="PythonUsage.html">Using the DetectorBank in Python </a> for a full description of calling the <a class="el" href="classDetectorBank.html" title="Use multiple detectors to find note onsets at given frequencies (with multithreading). ">DetectorBank</a> from Python.</p>
<p>Some short Python examples can be found <a class="el" href="PythonExamples.html">here</a>.</p>
<h1><a class="anchor" id="customisation"></a>
Customisation</h1>
<p>As distributed, the package prints out debugging messages. These can be disabled by altering <code>setup.py</code> or the Makefile depending on which method you are using for building.</p>
<p>To you ''have'' to change the type of the input or output data, edit the typedefs in <code><a class="el" href="detectorbank_8h_source.html">detectorbank.h</a></code> to reflect the desired types, and the <code>apply</code> statements in <code>detectorbank.i</code> to make sure the SWIG binding still works, then rebuild.</p>
<p>You'll also have to persuade the build system to link the fftw library with a resolution appropriate to new input sample precision (used in the FFT version of the hilbert transform). Good luck with that. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
